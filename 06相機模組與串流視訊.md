## 1. åŸºæœ¬å®‰è£ç›¸æ©Ÿæ¨¡çµ„

![upgit_20250417_1744820847.png|564x423](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/04/upgit_20250417_1744820847.png)

ç›¸æ©Ÿæ¨¡çµ„çš„é‡‘å±¬é¢ï¼Œæœå‘ SD å¡é¢

### 1.1. ç›¸æ©Ÿåˆå§‹åŒ–æ¸¬è©¦æŒ‡ä»¤ rpicam-hello

```shell
raspberrypi@raspberrypi:~ $ rpicam-hello
# é–‹å•Ÿç›¸æ©Ÿ
# é¡¯ç¤ºé è¦½ç•«é¢
# 5 ç§’å¾Œè‡ªå‹•çµæŸ
```

```shell
# é¡¯ç¤ºé è¦½ä½†å»¶é•·æ™‚é–“ï¼ˆä¾‹å¦‚ 10 ç§’ï¼‰
rpicam-hello --timeout 10000  # å–®ä½æ˜¯æ¯«ç§’ï¼Œé€™è£¡æ˜¯ 10 ç§’

# æ‹ä¸€å¼µç…§ç‰‡
rpicam-still -o image.jpg
# --vflip å·¦å³é¡›å€’
# --hflip ä¸Šä¸‹é¡›å€’
# -oé è¨­æ˜¯è¼¸å‡ºjpgæ ¼å¼ï¼Œå¦‚æœéœ€è¦å…¶ä»–æ ¼å¼ï¼Œè¦åŠ  -eï¼Œåƒæ˜¯
# rpicam-still -o image.png -e png

# éŒ„å½± 5 ç§’å½±ç‰‡ï¼š
rpicam-video -o video.h264 --timeout 5000
```

![upgit_20250417_1744821294.png|628x352](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/04/upgit_20250417_1744821294.png)

### 1.2. Lab ä½¿ç”¨ rpicam-hello æ‹ä¸€å¼µç…§

```shell
# æ‹ä¸€å¼µç…§ç‰‡
rpicam-still -o image.jpg
```

![upgit_20250417_1744821475.png|702x416](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/04/upgit_20250417_1744821475.png)

## 2. ä½¿ç”¨ python äº¤äº’ç›¸æ©Ÿæ¨¡çµ„

### 2.1. Labï¼šä½¿ç”¨ picamera2 é€²è¡Œæ‹ç…§

> å¦‚æœé‡åˆ° ModuleNotFoundError: No module named 'picamera2'
> å°±å¾—é€²è¡Œå®‰è£ï¼šsudo apt install python3-picamera2

```python
# ç¨‹å¼ç¢¼
from picamera2 import Picamera2
from time import sleep

picam2 = Picamera2()
# é¸æ“‡ã€Œæ‹ç…§ã€ç”¨é€”çš„ç›¸æ©Ÿè¨­å®šï¼ˆstill configurationï¼‰
picam2.configure(picam2.create_still_configuration())
picam2.start() # å•Ÿå‹•ç›¸æ©Ÿï¼ˆé¡é ­æœƒé–‹å§‹æ•æ‰å½±åƒï¼‰
sleep(2) # æš«åœ 2 ç§’ï¼Œè®“é¡é ­å°ç„¦æˆ–è‡ªå‹•èª¿å…‰å®Œæˆ
picam2.capture_file("test.jpg") # æ‹ç…§ä¸¦å„²å­˜ç‚º test.jpg
picam2.stop() # åœæ­¢ç›¸æ©Ÿ
print("image save test.jpg")
```

![upgit_20250417_1744824151.png](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/04/upgit_20250417_1744824151.png)

### 2.2. Labï¼šä½¿ç”¨ picamera2 é€²è¡ŒéŒ„å½±

```python
# ç¨‹å¼ç¢¼
from picamera2 import Picamera2
from picamera2.encoders import H264Encoder
from picamera2.outputs import FfmpegOutput
from time import sleep

camera2 = Picamera2()
camera_config = camera2.create_video_configuration() # å»ºç«‹ä¸€çµ„ã€Œç”¨ä¾†éŒ„å½±ã€çš„ç›¸æ©Ÿè¨­å®šï¼ˆè§£æåº¦ã€å¹€ç‡ç­‰ï¼‰
camera2.configure(camera_config) # å¥—ç”¨è¨­å®šåˆ°ç›¸æ©Ÿ

encoder = H264Encoder() # å»ºç«‹å½±ç‰‡ç·¨ç¢¼å™¨ï¼ˆä½¿ç”¨ H.264 å£“ç¸®æ ¼å¼ï¼‰
video_output = FfmpegOutput("./test.mp4")

camera2.start()
sleep(2)  # ç­‰å¾…å°ç„¦/ç©©å®š
camera2.start_recording(encoder, output=video_output) # é–‹å§‹éŒ„å½±ï¼Œä¸¦å°‡ç•«é¢è¼¸å‡ºåˆ°æŒ‡å®šçš„å½±ç‰‡æª”æ¡ˆä¸­
sleep(5)
camera2.stop_recording() # åœæ­¢éŒ„å½±
camera2.stop() # åœæ­¢ç›¸æ©Ÿï¼ˆé‡‹æ”¾è³‡æºï¼‰
print("save test.mp4")
```

### 2.3. Labï¼šä½¿ç”¨ç›¸æ©Ÿæ¨¡çµ„é€²è¡Œä¸²æµè¦–è¨Š

```
# å®‰è£
pip install flask opencv-python numpy
```

```python
from flask import Flask, Response
from picamera2 import Picamera2
import cv2
import time

app = Flask(__name__)
picam2 = Picamera2()
picam2.configure(picam2.create_preview_configuration(main={"format": "RGB888", "size": (640, 480)}))
picam2.start()

time.sleep(2)  # ç­‰ç›¸æ©Ÿå•Ÿå‹•ç©©å®š

def generate_frames():
    while True:
        frame = picam2.capture_array()
        ret, buffer = cv2.imencode('.jpg', frame)
        frame = buffer.tobytes()
        yield (b'--frame\r\n'
               b'Content-Type: image/jpeg\r\n\r\n' + frame + b'\r\n')

@app.route('/')
def index():
    return "<h1>Raspberry Pi Camera Streaming</h1><img src='/video'>"

@app.route('/video')
def video():
    return Response(generate_frames(),
                    mimetype='multipart/x-mixed-replace; boundary=frame')

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
```

![upgit_20250417_1744824812.png](https://raw.githubusercontent.com/kcwc1029/obsidian-upgit-image/main/2025/04/upgit_20250417_1744824812.png)

## 3. å¤–æ¥ webcam

```
(test_env) raspberrypi@raspberrypi:~/Desktop/camera $ lsusb
Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 001 Device 003: ID 1b3f:2247 Generalplus Technology Inc. GENERAL WEBCAM (é€™å€‹)
```

æ¥è‘—ï¼Œéœ€è¦çŸ¥é“ webcam å°æ‡‰åˆ°å“ªå€‹è™›æ“¬ç›®éŒ„ï¼Œåƒæ˜¯ä¾‹å¦‚ `/dev/video0`ã€`/dev/video1`...

```
(test_env) raspberrypi@raspberrypi:~/Desktop/camera $ v4l2-ctl --list-devices
GENERAL WEBCAM: GENERAL WEBCAM (usb-0000:01:00.0-1.4):
        /dev/video0
        /dev/video1
        /dev/media4

# å°æ‡‰åˆ°/dev/video0
```

### 3.1. ä½¿ç”¨ fswebcam

```
# å®‰è£
sudo apt install -y fswebcam
```

### 3.2. Labï¼šä½¿ç”¨æŒ‡ä»¤é€²è¡Œ fswebcam æ‹ç…§

```shell
fswebcam -d /dev/video0 -r 640x480 --delay 3 --no-banner webcam.jpg

# fswebcamé è¨­è§£æåº¦ç‚º352x288ï¼Œé€™æ¨£æ•ˆæœå¤ªå·®
# å°‡è§£æåº¦æ‹‰é«˜åˆ°640x480
# ç­‰å¾… 3 ç§’å†æ‹ç…§ï¼Œè®“æ›å…‰è‡ªå‹•èª¿æ•´
# --no-banner âœ ä¸åœ¨ç…§ç‰‡åŠ ä¸Šæ™‚é–“æˆ³è¨˜
```

### 3.3. Labï¼šä½¿ç”¨ python é€²è¡Œ fswebcam æ‹ç…§

#### 3.3.1. ç·´ç¿’ 01

åªæ˜¯æŠŠ shell æŒ‡ä»¤ï¼Œæ”¹æˆç”¨ python çš„ os åŸ·è¡Œè€Œå·²

```python
import os

action = "fswebcam -d /dev/video0 -r 640x480 --delay 5 --no-banner webcam.jpg"
os.system(action)
```

#### 3.3.2. ç·´ç¿’ 02

```python
# é€£æ‹+æ™‚é–“åšæˆ³è¨˜
import os
import time


for i in range(3):
    dt = time.strftime("%Y_%m_%d-%H_%M_%S")
    action = "fswebcam -d /dev/video0 -r 640x480 --delay 5 --no-banner image" + str(dt) + ".jpg"
    os.system(action)
    time.sleep(5)
```

### 3.4. Labï¼šä½¿ç”¨ fswebcam ä¸²æµè¦–è¨Š

```shell
# å®‰è£
pip install flask opencv-python
```

```python
from flask import Flask, Response
import cv2

app = Flask(__name__)
camera = cv2.VideoCapture(0)  # ä½¿ç”¨é è¨­ç›¸æ©Ÿï¼Œå¦‚æœä½ è¦æ¥ Pi Cameraï¼Œè¦æ”¹æˆ picamera2 æ¨¡å¼

def generate_frames():
    while True:
        success, frame = camera.read()
        if not success:
            break
        else:
            # å°‡ç•«é¢è½‰ç‚º JPEG æ ¼å¼
            ret, buffer = cv2.imencode('.jpg', frame)
            frame = buffer.tobytes()

            # ä½¿ç”¨ multipart å‚³å›ä¸²æµæ ¼å¼
            yield (b'--frame\r\n'
                   b'Content-Type: image/jpeg\r\n\r\n' + frame + b'\r\n')

@app.route('/')
def index():
    return "<h1>ğŸ”´ Raspberry Pi Camera Streaming</h1><img src='/video'>"

@app.route('/video')
def video():
    return Response(generate_frames(),
                    mimetype='multipart/x-mixed-replace; boundary=frame')

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
```
